<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: piler.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: piler.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

/**
 * @namespace Piler
 */
var BasePile, CSSManager, CSSPile, JSManager, JSPile, LiveUpdateMixin, OB, PileManager, asCodeOb, assetUrlParse, async, cache, compilers, crypto, cssMinify, debug, defNs, executableFrom, extension, fs, getCompiler, jsMinify, logger, path, production, reserved, toGlobals, wrapInScriptTagInline, _, _ref,
  __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i &lt; l; i++) { if (i in this &amp;&amp; this[i] === item) return i; } return -1; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  __slice = [].slice;

cache = require('./cache');

fs = require("graceful-fs");

path = require("path");

crypto = require('crypto');

path = require("path");

debug = require("debug")("piler:piler");

reserved = require('reserved');

_ = require("underscore");

async = require("async");

_ref = require("./minify"), jsMinify = _ref.jsMinify, cssMinify = _ref.cssMinify;

OB = require("./serialize");

compilers = require("./compilers");

assetUrlParse = require("./asseturlparse");

logger = require("./logger");

toGlobals = function(globals) {
  var code, nsString, v;
  code = "";
  for (nsString in globals) {
    v = globals[nsString];
    code += "__SET(" + (JSON.stringify(nsString)) + ", " + (OB.stringify(v)) + ");\n";
  }
  return code;
};

extension = function(filename) {
  var parts;
  parts = filename.split(".");
  return parts[parts.length - 1];
};

wrapInScriptTagInline = function(code) {
  return "&lt;script type=\"text/javascript\" >\n" + code + "\n&lt;/script>\n";
};

getCompiler = function(filePath) {
  var compiler;
  compiler = compilers[extension(filePath)];
  if (!compiler) {
    throw new Error("Could not find compiler for " + filePath);
  }
  return compiler.render;
};


/**
 * A code object
 * @typedef {Object} Piler.codeOb
 * @property {Function} getId Get the code id
 * @property {Function} getCode Get the code itself
 */

asCodeOb = (function() {
  var getId, pilers;
  getId = function() {
    var filename, hash, sum, _ref1;
    sum = crypto.createHash('sha1');
    if (this.type === "file") {
      sum.update(this.filePath);
    } else {
      sum.update(OB.stringify(this));
    }
    hash = sum.digest('hex').substring(10, 0);
    if ((_ref1 = this.type) === "file" || _ref1 === "module") {
      filename = path.basename(this.filePath);
      filename = filename.replace(/\./g, "_");
      filename = filename.replace(/\-/g, "_");
      hash = filename + "_" + hash;
    }
    return hash;
  };
  pilers = {
    raw: function(ob, cb) {
      cb(null, ob.raw);
    },
    object: function(ob, cb) {
      cb(null, toGlobals(ob.object));
    },
    exec: function(ob, cb) {
      cb(null, executableFrom(ob.object));
    },
    file: function(ob, cb) {
      fs.readFile(ob.filePath, function(err, data) {
        if (err) {
          return typeof cb === "function" ? cb(err) : void 0;
        }
        getCompiler(ob.filePath)(ob.filePath, data.toString(), function(err, code) {
          return cb(err, code);
        });
      });
    },
    module: function(ob, cb) {
      this.file(ob, function(err, code) {
        if (err) {
          return typeof cb === "function" ? cb(err) : void 0;
        }
        cb(null, "require.register(\"" + (path.basename(ob.filePath).split(".")[0]) + "\", function(module, exports, require) {\n" + code + "\n});");
      });
    }
  };
  return function() {
    this.getId = getId;
    this.getCode = function(cb) {
      return pilers[this.type](this, cb);
    };
    return this;
  };
})();

BasePile = (function() {

  /**
   * @member {String} urlRoot
   * @instance
   * @memberof Piler.BasePile
   */
  BasePile.prototype.urlRoot = "/piler/";


  /**
   * @member {Boolean} production
   * @instance
   * @memberof Piler.BasePile
   */

  BasePile.prototype.production = false;


  /**
   * @constructor Piler.BasePile
   */

  function BasePile(name, production, urlRoot, cacheKeys) {
    this.name = name;
    this.production = production;
    if (urlRoot != null) {
      this.urlRoot = urlRoot;
    }
    this.code = [];
    this.rawPile = null;
    this.urls = [];
    this.piledUp = false;
    this.cacheKeys = cacheKeys !== void 0 ? !!cacheKeys : true;
  }


  /**
   * Add an array of files at once
   *
   * @example
   *   Pile.addFile("/path/to/file")
   *
   * @memberof BasePile
   * @function addFile
   * @instance
   * @param {String} filePath Absolute path to the file
   * @param {Boolean} [before] Prepend this file instead of adding to the end of the pile
   *
   * @returns {Piler.BasePile}
   */

  BasePile.prototype.addFile = function(filePath, before) {
    if (before == null) {
      before = false;
    }
    filePath = path.normalize(filePath);
    this.warnPiledUp("addFile");
    if (__indexOf.call(this.getFilePaths(), filePath) &lt; 0) {
      this.code[!before ? 'push' : 'unshift'](asCodeOb.call({
        type: "file",
        filePath: filePath
      }));
    }
    return this;
  };


  /**
   * @memberof Piler.BasePile
   * @function addRaw
   * @param {*} raw
   * @param {Boolean} [before]
   * @instance
   * @returns {Piler.BasePile}
   */

  BasePile.prototype.addRaw = function(raw, before) {
    if (before == null) {
      before = false;
    }
    this.warnPiledUp("addRaw");
    this.code[!before ? 'push' : 'unshift'](asCodeOb.call({
      type: "raw",
      raw: raw
    }));
    return this;
  };


  /**
   * @memberof Piler.BasePile
   * @function getFilePaths
   * @instance
   * @returns {Piler.BasePile}
   */

  BasePile.prototype.getFilePaths = function() {
    var ob, _i, _len, _ref1, _results;
    _ref1 = this.code;
    _results = [];
    for (_i = 0, _len = _ref1.length; _i &lt; _len; _i++) {
      ob = _ref1[_i];
      if (ob.type === "file") {
        _results.push(ob.filePath);
      }
    }
    return _results;
  };


  /**
   * @memberof Piler.BasePile
   * @function addUrl
   * @param {String} url
   * @param {Boolean} [before]
   * @instance
   * @returns {Piler.BasePile}
   */

  BasePile.prototype.addUrl = function(url, before) {
    if (before == null) {
      before = false;
    }
    if (__indexOf.call(this.urls, url) &lt; 0) {
      this.urls[!before ? 'push' : 'unshift'](url);
    }
    return this;
  };


  /**
   * @memberof Piler.BasePile
   * @function getSources
   * @instance
   * @returns {Piler.BasePile}
   */

  BasePile.prototype.getSources = function() {
    var devCacheKey, ob, sources, u, _i, _len, _ref1;
    sources = (function() {
      var _i, _len, _ref1, _results;
      _ref1 = this.urls;
      _results = [];
      for (_i = 0, _len = _ref1.length; _i &lt; _len; _i++) {
        u = _ref1[_i];
        _results.push([u]);
      }
      return _results;
    }).call(this);
    if (this.production) {
      sources.push(["" + this.urlRoot + "min/" + this.pileHash + "/" + this.name + "." + this.ext]);
    } else {
      devCacheKey = '';
      if (this.cacheKeys) {
        devCacheKey = "?v=" + (Date.now());
      }
      _ref1 = this.code;
      for (_i = 0, _len = _ref1.length; _i &lt; _len; _i++) {
        ob = _ref1[_i];
        sources.push(["" + this.urlRoot + "dev/" + this.name + "." + ob.type + "-" + (ob.getId()) + "." + this.ext + devCacheKey, "id=\"pile-" + (ob.getId()) + "\""]);
      }
    }
    return sources;
  };


  /**
   * @memberof Piler.BasePile
   * @function findCodeObById
   * @param {String} id
   * @instance
   * @returns {Piler.codeOb}
   */

  BasePile.prototype.findCodeObById = function(id) {
    var codeOb;
    return ((function() {
      var _i, _len, _ref1, _results;
      _ref1 = this.code;
      _results = [];
      for (_i = 0, _len = _ref1.length; _i &lt; _len; _i++) {
        codeOb = _ref1[_i];
        if (codeOb.getId() === id) {
          _results.push(codeOb);
        }
      }
      return _results;
    }).call(this))[0];
  };


  /**
   * @memberof Piler.BasePile
   * @function findCodeObByFilePath
   * @param {String} path
   * @instance
   * @returns {Piler.codeOb}
   */

  BasePile.prototype.findCodeObByFilePath = function(path) {
    var codeOb;
    return ((function() {
      var _i, _len, _ref1, _results;
      _ref1 = this.code;
      _results = [];
      for (_i = 0, _len = _ref1.length; _i &lt; _len; _i++) {
        codeOb = _ref1[_i];
        if (codeOb.filePath === path) {
          _results.push(codeOb);
        }
      }
      return _results;
    }).call(this))[0];
  };


  /**
   * @memberof {Piler.BasePile}
   * @function _computeHash
   * @instance
   * @private
   *
   * @returns {Piler.BasePile}
   */

  BasePile.prototype._computeHash = function() {
    var sum;
    sum = crypto.createHash('sha1');
    sum.update(this.rawPile);
    return this.pileHash = sum.digest('hex');
  };


  /**
   * @memberof {Piler.BasePile}
   * @function warnPiledUp
   * @instance
   * @protected
   */

  BasePile.prototype.warnPiledUp = function(fnname) {
    if (this.piledUp) {
      this.logger.warn("Warning pile " + this.name + " has been already piled up. Calling " + fnname + " does not do anything.");
    }
  };


  /**
   * @memberof {Piler.BasePile}
   * @function pileUp
   * @param {Function} [cb]
   * @instance
   * @returns {Piler.BasePile}
   */

  BasePile.prototype.pileUp = function(cb) {
    this.piledUp = true;
    async.map(this.code, (function(_this) {
      return function(codeOb, cb) {
        codeOb.getCode(function(err, code) {
          if (err) {
            return typeof cb === "function" ? cb(err) : void 0;
          }
          cb(null, _this.commentLine("" + codeOb.type + ": " + (codeOb.getId())) + ("\n" + code));
        });
      };
    })(this), (function(_this) {
      return function(err, result) {
        if (err) {
          return typeof cb === "function" ? cb(err) : void 0;
        }
        _this.rawPile = _this.minify(result.join("\n\n").trim());
        _this._computeHash();
        if (typeof cb === "function") {
          cb(null, _this.rawPile);
        }
      };
    })(this));
    return this;
  };

  return BasePile;

})();

JSPile = (function(_super) {
  __extends(JSPile, _super);


  /**
   * @member {String} ext
   * @memberof Piler.JSPile
   * @instance
   */

  JSPile.prototype.ext = "js";


  /**
   * Add line comment
   *
   * @function commentLine
   * @memberof Piler.JSPile
   * @returns {String}
   * @instance
   */

  JSPile.prototype.commentLine = function(line) {
    return "// " + (line.trim());
  };


  /**
   * Minify any valid Javascript code
   *
   * @memberof Piler.JSPile
   * @returns {String}
   * @instance
   */

  JSPile.prototype.minify = function(code) {
    if (this.production) {
      return jsMinify(code);
    } else {
      return code;
    }
  };


  /**
   * @augments Piler.BasePile
   * @constructor Piler.JSPile
   */

  function JSPile() {
    JSPile.__super__.constructor.apply(this, arguments);
    this.objects = [];
  }


  /**
   * Add a CommonJS module
   * @memberof Piler.JSPile
   * @function addModule
   * @param {String} filePath
   * @param {Boolean} [before]
   * @instance
   * @returns {Piler.JSPile}
   */

  JSPile.prototype.addModule = function(filePath, before) {
    if (before == null) {
      before = false;
    }
    filePath = path.normalize(filePath);
    this.warnPiledUp("addFile");
    if (__indexOf.call(this.getFilePaths(), filePath) &lt; 0) {
      this.code[!before ? 'push' : 'unshift'](asCodeOb.call({
        type: "module",
        filePath: filePath
      }));
    }
    return this;
  };


  /**
   * Add a CommonJS module
   * @memberof Piler.JSPile
   * @param {Object} ob
   * @param {Boolean} [before]
   * @instance
   * @returns {Piler.JSPile}
   */

  JSPile.prototype.addOb = function(ob, before) {
    if (before == null) {
      before = false;
    }
    this.warnPiledUp("addOb");
    this.code[!before ? 'push' : 'unshift'](asCodeOb.call({
      type: "object",
      object: ob
    }));
    return this;
  };


  /**
   * Add a CommonJS module
   * @memberof Piler.JSPile
   * @param {Function} fn
   * @param {Boolean} [before]
   * @instance
   * @function addExec
   * @returns {Piler.JSPile}
   */

  JSPile.prototype.addExec = function(fn, before) {
    if (before == null) {
      before = false;
    }
    this.warnPiledUp("addExec");
    this.code[!before ? 'push' : 'unshift'](asCodeOb.call({
      type: "exec",
      object: fn
    }));
    return this;
  };

  return JSPile;

})(BasePile);

CSSPile = (function(_super) {
  __extends(CSSPile, _super);


  /**
   * @member {String} ext
   * @memberof Piler.CSSPile
   * @instance
   */

  CSSPile.prototype.ext = "css";


  /**
   * @constructor Piler.CSSPile
   * @augments Piler.BasePile
   */

  function CSSPile() {
    CSSPile.__super__.constructor.apply(this, arguments);
  }


  /**
   * Add a line comment to CSS
   *
   * @memberof Piler.CSSPile
   * @param {String} line
   * @instance
   * @function commentLine
   * @returns {Piler.CSSPile}
   */

  CSSPile.prototype.commentLine = function(line) {
    return "/* " + (line.trim()) + " */";
  };


  /**
   * Minify any CSS code
   *
   * @memberof Piler.CSSPile
   * @param {String} code
   * @instance
   * @function minify
   * @returns {Piler.CSSPile}
   */

  CSSPile.prototype.minify = function(code) {
    if (this.production) {
      return cssMinify(code);
    } else {
      return code;
    }
  };

  return CSSPile;

})(BasePile);

defNs = function(fn) {
  return function(ns, path) {
    if (arguments.length === 1) {
      path = ns;
      ns = "global";
    }
    return fn.call(this, ns, path);
  };
};

PileManager = (function() {

  /**
   * @memberof Piler.PileManager
   * @member {Piler.BasePile} Type
   * @instance
   */
  PileManager.prototype.Type = null;


  /**
   * @constructor Piler.PileManager
   */

  function PileManager(settings) {
    var _base;
    this.settings = settings;
    this.production = this.settings.production;
    if ((_base = this.settings).urlRoot == null) {
      _base.urlRoot = "/pile/";
    }
    this.logger = this.settings.logger || logger;
    this.piles = {
      global: new this.Type("global", this.production, this.settings.urlRoot)
    };
  }


  /**
   * @memberof Piler.PileManager
   * @instance
   * @function getPile
   * @returnss {Piler.BasePile}
   */

  PileManager.prototype.getPile = function(ns) {
    var pile;
    pile = this.piles[ns];
    if (!pile) {
      pile = this.piles[ns] = new this.Type(ns, this.production, this.settings.urlRoot);
    }
    return pile;
  };


  /**
   * Add an array of files at once
   *
   * @example
   *   PileManager.addFiles("namespace", ["/file/1","/file/2"])
   *
   * @memberof Piler.PileManager
   *
   * @function addFiles
   * @param {String} ns
   * @param {Array} arr
   *
   * @returns {Piler.BasePile}
   */

  PileManager.prototype.addFiles = defNs(function(ns, arr) {
    var file, _i, _len;
    for (_i = 0, _len = arr.length; _i &lt; _len; _i++) {
      file = arr[_i];
      this.addFile(ns, file);
    }
    return this;
  });


  /**
   * @memberof Piler.PileManager
   */

  PileManager.prototype.addFile = defNs(function(ns, path) {
    var pile;
    pile = this.getPile(ns);
    return pile.addFile(path);
  });


  /**
   * @memberof Piler.PileManager
   */

  PileManager.prototype.addRaw = defNs(function(ns, raw) {
    var pile;
    pile = this.getPile(ns);
    return pile.addRaw(raw);
  });


  /**
   * @memberof Piler.PileManager
   */

  PileManager.prototype.addUrl = defNs(function(ns, url) {
    var pile;
    pile = this.getPile(ns);
    return pile.addUrl(url);
  });


  /**
   * @memberof Piler.PileManager
   */

  PileManager.prototype.pileUp = function() {
    var name, pile, _fn, _ref1;
    logger = this.logger;
    logger.notice("Start assets generation for '" + this.Type.prototype.ext + "'");
    _ref1 = this.piles;
    _fn = (function(_this) {
      return function(pile) {
        return pile.pileUp(function(err, code) {
          var outputPath;
          if (err) {
            throw err;
          }
          if (_this.settings.outputDirectory != null) {
            outputPath = path.join(_this.settings.outputDirectory, "" + pile.name + "." + pile.ext);
            fs.writeFile(outputPath, code, function(err) {
              if (err) {
                throw err;
              }
              return logger.info("Wrote " + pile.ext + " pile " + pile.name + " to " + outputPath);
            });
          }
        });
      };
    })(this);
    for (name in _ref1) {
      pile = _ref1[name];
      _fn(pile);
    }
  };


  /**
   * @memberof Piler.PileManager
   */

  PileManager.prototype.getSources = function() {
    var namespaces, ns, opts, pile, sources, _i, _len;
    namespaces = 1 &lt;= arguments.length ? __slice.call(arguments, 0) : [];
    if (typeof _.last(namespaces) === "object") {
      opts = namespaces.pop();
    } else {
      opts = {};
    }
    if (!opts.disableGlobal) {
      namespaces.unshift("global");
    }
    sources = [];
    for (_i = 0, _len = namespaces.length; _i &lt; _len; _i++) {
      ns = namespaces[_i];
      if (pile = this.piles[ns]) {
        sources.push.apply(sources, pile.getSources());
      }
    }
    return sources;
  };


  /**
   * @memberof Piler.PileManager
   */

  PileManager.prototype.renderTags = function() {
    var namespaces, src, tags, _i, _len, _ref1;
    namespaces = 1 &lt;= arguments.length ? __slice.call(arguments, 0) : [];
    tags = "";
    _ref1 = this.getSources.apply(this, namespaces);
    for (_i = 0, _len = _ref1.length; _i &lt; _len; _i++) {
      src = _ref1[_i];
      tags += this.wrapInTag(src[0], src[1]);
      tags += "\n";
    }
    return tags;
  };


  /**
   * @memberof Piler.PileManager
   */

  PileManager.prototype.bind = function(app, server) {
    if (!server) {
      throw new Error('You must pass an existing server to bind function as second parameter');
    }
    this.app = app;
    this.server = server;
    server.on("listening", (function(_this) {
      return function() {
        _this.pileUp();
      };
    })(this));
    this.setMiddleware(app);
    app.use((function(_this) {
      return function(req, res, next) {
        var asset, codeOb, pile;
        if (!_.startsWith(req.url, _this.settings.urlRoot)) {
          return next();
        }
        res.setHeader("Content-type", _this.contentType);
        asset = assetUrlParse(req.url);
        if (asset.ext !== _this.Type.prototype.ext) {
          return next();
        }
        pile = _this.piles[asset.name];
        if (!pile) {
          res.send("Cannot find pile " + asset.name, 404);
          return;
        }
        if (asset.min) {
          res.end(pile.rawPile);
          return;
        }
        codeOb = pile.findCodeObById(asset.dev.uid);
        codeOb.getCode(function(err, code) {
          if (err) {
            throw err;
          }
          res.end(code);
        });
      };
    })(this));
  };

  return PileManager;

})();

JSManager = (function(_super) {
  __extends(JSManager, _super);

  JSManager.prototype.Type = JSPile;

  JSManager.prototype.contentType = "application/javascript";


  /**
   * @constructor Piler.JSManager
   * @augments Piler.PileManager
   */

  function JSManager() {
    JSManager.__super__.constructor.apply(this, arguments);
    this.piles.global.addExec(function() {
      window._NS = function(nsString) {
        var ns, parent, _i, _len, _ref1;
        parent = window;
        _ref1 = nsString.split(".");
        for (_i = 0, _len = _ref1.length; _i &lt; _len; _i++) {
          ns = _ref1[_i];
          parent = parent[ns] != null ? parent[ns] : parent[ns] = {};
        }
        return parent;
      };
      return window.__SET = function(ns, ob) {
        var nsOb, parts, target;
        parts = ns.split(".");
        if (parts.length === 1) {
          return window[parts[0]] = ob;
        } else {
          nsOb = _NS(parts.slice(0, -1).join("."));
          target = parts.slice(-1)[0];
          return nsOb[target] = ob;
        }
      };
    });
    return;
  }

  JSManager.prototype.wrapInTag = function(uri, extra) {
    if (extra == null) {
      extra = "";
    }
    return "&lt;script type=\"text/javascript\"  src=\"" + uri + "\" " + extra + " >&lt;/script>";
  };

  JSManager.prototype._isReserved = function(ns) {
    if (reserved.indexOf(ns) !== -1) {
      throw new Error("" + ns + " is a reserved word and can't be used");
    }
  };

  JSManager.prototype.addModule = defNs(function(ns, path) {
    var pile;
    this._isReserved(ns);
    pile = this.getPile(ns);
    return pile.addModule(path);
  });

  JSManager.prototype.addOb = defNs(function(ns, ob) {
    var pile;
    this._isReserved(ns);
    pile = this.getPile(ns);
    return pile.addOb(ob);
  });

  JSManager.prototype.addExec = defNs(function(ns, fn) {
    var pile;
    this._isReserved(ns);
    pile = this.getPile(ns);
    return pile.addExec(fn);
  });

  JSManager.prototype.setMiddleware = function(app) {
    var responseExec, responseOb;
    responseExec = function(fn) {
      this._responseFns.push(fn);
    };
    responseOb = function(ob) {
      this._responseObs.push(ob);
    };
    app.use(function(req, res, next) {
      if (res._responseFns == null) {
        res._responseFns = [];
      }
      if (res._responseObs == null) {
        res._responseObs = [];
      }
      res.exec = res.addExec = responseExec;
      res.addOb = responseOb;
      next();
    });
  };

  return JSManager;

})(PileManager);

CSSManager = (function(_super) {
  __extends(CSSManager, _super);


  /**
   * @member {CSSPile} Type
   * @memberof Piler.CSSManager
   * @instance
   */

  CSSManager.prototype.Type = CSSPile;


  /**
   * @member {String} contentType
   * @memberof Piler.CSSManager
   * @instance
   */

  CSSManager.prototype.contentType = "text/css";


  /**
   * @constructor Piler.CSSManager
   * @augments Piler.PileManager
   */

  function CSSManager() {
    CSSManager.__super__.constructor.apply(this, arguments);
  }


  /**
   * Wrap a stylesheet path in a link tag
   *
   * @memberof Piler.CSSManager
   * @function wrapInTag
   * @instance
   * @returns {String}
   */

  CSSManager.prototype.wrapInTag = function(uri, extra) {
    if (extra == null) {
      extra = "";
    }
    return "&lt;link rel=\"stylesheet\" href=\"" + uri + "\" " + extra + " />";
  };


  /**
   * @memberof Piler.CSSManager
   * @function setMiddleware
   * @instance
   */

  CSSManager.prototype.setMiddleware = function(app) {};

  return CSSManager;

})(PileManager);

executableFrom = function(fn, context) {
  if (!context) {
    return "(" + fn + ")();\n";
  }
  return "(" + fn + ").call(" + context + ");\n";
};

LiveUpdateMixin = require("./livecss");

_.extend(JSManager.prototype, LiveUpdateMixin.prototype);

exports.production = production = process.env.NODE_ENV === "production";

exports.BasePile = BasePile;

exports.CSSPile = CSSPile;

exports.JSPile = JSPile;

exports.JSManager = JSManager;

exports.CSSManager = CSSManager;


/**
 * Create a new JS Manager for adding Javascript files
 *
 * @param {Object} [settings] Settings to pass to JSManager
 *
 * @function Piler.createJSManager
 * @returns {Piler.JSManager}
 */

exports.createJSManager = function(settings) {
  if (settings == null) {
    settings = {};
  }
  settings.production = production;
  return new JSManager(settings);
};


/**
 * Create a new CSS Manager for adding stylesheet files
 *
 * @function Piler.createCSSManager
 *
 * @param {Object} [settings] Settings to pass to CSSManager
 * @returns {Piler.CSSManager}
 */

exports.createCSSManager = function(settings) {
  if (settings == null) {
    settings = {};
  }
  settings.production = production;
  return new CSSManager(settings);
};


/**
 * Add a compiler to Piler. You can override existing extensions like css or js
 *
 * @function Piler.addCompiler
 *
 * @throws Error
 * @param {String} extension The extension that you want compiling
 * @param {Function} renderFn The function that will be factory for generating code
 */

exports.addCompiler = function(extension, renderFn) {
  var def;
  if (!_.isFunction(renderFn)) {
    throw new Error('addCompiler function expects a function as second parameter');
  }
  def = renderFn();
  if (_.isObject(def) &amp;&amp; _.isFunction(def.render)) {
    compilers[extension] = def;
  } else {
    throw new Error('Your function must return an object containing "render" and optionally "targetExt"');
  }
};


/**
 * @function Piler.removeCompiler
 * @param {String} extension Extension to remove the compiler
 */

exports.removeCompiler = function(extension) {
  if (compilers[extension]) {
    delete compilers[extension];
  }
};


/**
 * Add the cache method.
 * By default it uses the filesystem
 *
 * @example
 *   piler.useCache(function(){
 *   });
 *
 * @param {Function} cacheFn Function that will be called with the current code, generated hash and the callback
 * @throws Error
 *
 * @function Piler.useCache
 */

exports.useCache = function(cacheFn) {
  if (!_.isFunction(cacheFn)) {
    throw new Error('useCache expects a function');
  }
  if (cacheFn.length &lt; 3) {
    throw new Error('useCache expects a function with 3 arguments defined');
  }
  cache.options.useFS = false;
  cache.options.cacheCallback = cacheFn;
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="Piler.BasePile.html">BasePile</a></li><li><a href="Piler.CSSManager.html">CSSManager</a></li><li><a href="Piler.CSSPile.html">CSSPile</a></li><li><a href="Piler.JSManager.html">JSManager</a></li><li><a href="Piler.JSPile.html">JSPile</a></li><li><a href="Piler.PileManager.html">PileManager</a></li></ul><h3>Namespaces</h3><ul><li><a href="Piler.html">Piler</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha8</a> on Sun Jun 15 2014 10:35:44 GMT-0300 (E. South America Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
